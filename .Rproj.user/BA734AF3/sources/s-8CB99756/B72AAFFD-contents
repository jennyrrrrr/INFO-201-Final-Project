#
# This is the server logic of a Shiny web application. You can run the
# application by clicking 'Run App' above.
#
# Find out more about building applications with Shiny here:
#
#    http://shiny.rstudio.com/
#

library(shiny)
source("propublica.R")

server <- shinyServer(function(input, output) {
  output$rep_by_state <- renderTable({
    house_rep_by_state(input$state)
  },
  digits = 0
  )
  output$names <- reactive({
    renderText(names_by_state(input$state))
  })
  get_table <- reactive({
    house_rep_by_state(input$state)
  })

  output$select_representative <- renderUI({
    selectInput(
      inputId = "name",
      label = "View more information",
      choices = get_table()$name,
      selected = get_table()$name[1]
    )
  })

  output$rep_details <- renderTable({
    name_to_id(input$name, input$state)
  })

  output$gender_plot <- renderPlot(
    gender_plot(input$plotState)
  )

  output$rep_plot <- renderPlot(
    rep_plot(input$plotState)
  )

  output$about <- renderUI(
    withTags({
      p(
        "Makenna Barton",
        br("INFO-201A: Technical Foundations of Informatics"),
        "The Information School",
        br("University of Washington"),
        "Autumn 2019"
      )
    })
  )

  output$overview <- renderUI({
    withTags({
      p(
        "This application contains detailed information about
                     the ", b("United States Congressional Representatives."),
        "It is
                      being displayed to you through an open source R package
                      called “Shiny”. Shiny allows the programmer to develop
                      interactive applications that can be deployed to the web
                      and accessed on any browser through the Shiny server.",
        br("The information provided is sourced from the ProPublica
                     API, accessed through site queries using a unique key.
                      The queries used access both House Representatives by
                      state as well as specific information for an individual
                      representative."),
        a("You can access ProPublica here.",
          href =
            "https://projects.propublica.org/api-docs/congress-api/"
        ),
        br("Within R, the packages used in this application are:
                      httr, jsonlite, dplyr, and ggplot2. Httr and jsonlite
                      are necessary for accessing the API web data. Dplyr was
                      used to work through the data retrieved and collect the
                      information desired. Ggplot2 was used to make data
                      visualizations to show insights from the data.")
      )
    })
  })

  output$reflection <- renderUI({
    withTags({
      p("I found this project to be both challenging and rewarding.
                      The main obstacle I faced was working between the Shiny
                      Server and UI and the new functions that came along with
                      that. I extensively researched the Shiny and R
                      Documentation to try to get a grasp on the functions I
                      would need to complete this project. The best solution
                      to any problem was often a specified Google search
                      followed by looking through the trusted sources that
                      came up as results. The second main challenge I had was
                      debugging my code when there was a discrepancy between
                      the Server and UI. I found RStudio very difficult to
                      work with in this regard because the error messages are
                      general and do not offer a specified location of the
                      said error. This was my first time using an API and I
                      found the amount of information I could get from it
                      almost overwhelming. As I've learned from Cathy O'Neil,
                      Big Data is powerful, in a postive way and negative way.
                      I was able to use the data from this API in a positive
                      way that helped me learn a lot about the capabilities
                      of R. Overall, this project stretched my abilities
                      and I feel very proud of the final product. I am very
                      pleased with how much I learned from working through
                      this assignment.")
    })
  })
})
